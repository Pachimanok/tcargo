<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/componentes/plantilla :: head"></head>
<body class="horizontal-layout horizontal-menu 2-columns" data-open="hover" data-menu="horizontal-menu"
      data-col="2-columns">
<nav th:replace="fragments/componentes/plantilla :: header"></nav>
<nav th:replace="fragments/componentes/plantilla :: menu"></nav>

<div class="app-content content">
    <div class="content-overlay"></div>
    <div class="content-wrapper">
        <div class="content-header row">
            <div class="content-header-left col-12 mb-2">
                <h3 class="content-header-title"
                    th:text="#{text.edicionPerfil.form.h3.gestionUsuarios}"></h3>
                <div class="row breadcrumbs-top">
                    <div class="breadcrumb-wrapper col-12">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a th:href="@{/dashboard}">
                                <span th:text="#{text.tittle.home}"></span>
                            </a></li>
                            <li class="breadcrumb-item active"
                                th:text="#{text.edicionPerfil.form.li.usuario}"></li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-body">
            <section id="pagination">
                <form method="POST" th:action="@{/usuario/actualizacionperfil/}" id="formulario" novalidate="novalidate"
                      th:object="${usuario}">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h4 class="card-title black" th:if="${accion == null or accion == 'guardar'}"
                                        th:text="#{text.edicionPerfil.form.h4.crearUsuario}"></h4>
                                    <h4 class="card-title black" th:if="${accion == 'actualizar'}"
                                        th:text="#{text.edicionPerfil.form.h4.editarPerfil}"></h4>
                                    <h4 class="card-title black" th:if="${accion == 'eliminar'}"
                                        th:text="#{text.edicionPerfil.form.h4.eliminarUsuario}">
                                    </h4>
                                    <h4 th:if="${session.rolActual == 'chofer' AND usuario.nombreTransportador != null}"
                                        th:text="${usuario.nombreTransportador}" class="mt-2"></h4>
                                </div>
                                <div class="card-body">
                                    <div class="card-text">
                                        <div th:if="${error != null}" class="alert alert-danger" role="alert">
                                            <strong th:text="#{text.edicionPerfil.form.strong.error}"></strong>
                                            <span th:text="${error}">error</span>
                                        </div>
                                        <div th:if="${success != null}" class="alert alert-success" role="alert">
                                            <strong th:text="#{text.edicionPerfil.form.strong.success}"></strong>
                                            <span th:text="${success}"></span>
                                        </div>
                                        <div th:if="${alertRedirect != null}" class="alert alert-info" role="alert">
                                            <strong th:text="#{text.edicionPerfil.form.strong.info}"></strong>
                                            <p th:text="${alertRedirect}"></p>
                                        </div>
                                        <div th:if="${accion == 'eliminar'}"
                                             class="alert alert-danger" role="alert">
                                            <strong th:text="#{text.edicionPerfil.form.strong.alto}"></strong>
                                            <span th:text="#{text.edicionPerfil.form.span.seEncuentraSeguro}"></span>
                                        </div>
                                    </div>
                                    <input type="hidden" class="form-control" th:field="*{id}" th:value="*{id}"/>
                                    <input type="hidden" class="form-control" th:field="*{clave}" th:value="*{clave}"/>
                                    <input type="hidden" id="rol-request" name="rol"/>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h4 class="form-section">
                                                <i class="ft-user"></i>
                                                <span th:text="#{text.edicionPerfil.form.span.informacionCuenta}"></span>
                                            </h4>
                                        </div>
                                        <div class="col-md-12 col-sm-12">
                                            <div class="form-group">
                                                <label for="nombre">
                                                    <span th:text="#{text.edicionPerfil.form.label.nombre}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <input id="nombre" class="form-control" th:field="*{nombre}"
                                                       type="text" th:value="*{nombre}" required
                                                       th:placeholder="#{text.edicionPerfil.form.input.ingresaTuNombre}"
                                                       onkeydown="if(event.key==='.'){event.preventDefault();}"
                                                       maxlength="30"
                                                       oninput="event.target.value = event.target.value.replace(/[^a-zA-Z ñáéíóúüäëïöÁÉÍÓÚÑÄËÏÖÜÇçÂÊÎÕÛâêîûÃÕãõ]*/g,'');"/>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-sm-6">
                                            <div class="form-group">
                                                <label for="mail">
                                                    <span th:text="#{text.edicionPerfil.form.label.mail}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <input id="mail" class="form-control" th:field="*{mail}"
                                                       th:value="*{nombre}"
                                                       th:placeholder="#{text.edicionPerfil.form.input.ingreseCorreo}"
                                                       type="email" required/>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-sm-6">
                                            <div class="form-group">
                                                <label for="telefono">
                                                    <span th:text="#{text.edicionPerfil.form.label.telefono}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <input id="telefono" class="form-control" th:field="*{telefono}"
                                                       th:value="*{telefono}"
                                                       th:placeholder="#{text.edicionPerfil.form.input.ingreseTelefono}"
                                                       type="tel" required
                                                       onkeydown="if(event.key==='.'){event.preventDefault();}"
                                                       maxlength="30"
                                                       oninput="event.target.value = event.target.value.replace(/[^0-9 +-]*/g,'');"/>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-sm-6" th:if="${session.rolActual == 'chofer'}">
                                            <div class="form-group">
                                                <label for="mail-adicional"
                                                       th:text="#{text.edicionPerfil.form.label.mailAdicional}"></label>
                                                <input id="mail-adicional" class="form-control"
                                                       th:field="*{emailAdicional}"
                                                       th:value="*{emailAdicional}" type="email"
                                                       th:placeholder="#{text.edicionPerfil.form.input.ingreseCorreo}"/>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-sm-6" th:if="${session.rolActual == 'chofer'}">
                                            <div class="form-group">
                                                <label for="telefono-adicional"
                                                       th:text="#{text.edicionPerfil.form.label.telefonoAdicional}"></label>
                                                <input id="telefono-adicional" class="form-control"
                                                       th:field="*{telefonoAdicional}"
                                                       th:value="*{telefonoAdicional}" type="tel"
                                                       onkeydown="if(event.key==='.'){event.preventDefault();}"
                                                       maxlength="30"
                                                       oninput="event.target.value = event.target.value.replace(/[\d+-]*/g,'');"/>
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-sm-4">
                                            <div class="form-group">
                                                <label for="cuit">
                                                    <span th:text="#{text.edicionPerfil.form.label.cuit}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <input id="cuit" class="form-control" th:field="*{cuit}"
                                                       th:value="*{cuit}"
                                                       th:placeholder="#{text.edicionPerfil.form.input.ingresaTuCuit}"
                                                       type="number" required/>
                                                <span class="badge badge-info"
                                                      th:text="${usuario.cuitVerificado != true} ? #{text.edicionPerfil.form.span.sinVerificar} : #{text.edicionPerfil.form.span.verificado}"></span>
                                            </div>
                                        </div>

                                        <div class="col-md-4 col-sm-4" id="box-rolSelect"
                                             th:if="${session.usuario.rol.toString() != 'INVITADO' && session.usuario.rol.toString() != 'CHOFER'}">
                                            <div class="form-group">
                                                <label for="rol-select">
                                                    <span th:text="#{text.edicionPerfil.form.label.tipoUsuario}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <select id="rol-select" class="custom-select" required>
                                                    <option th:value="${''}"
                                                            th:text="#{text.edicionPerfil.form.option.seleccionaTipoUsuario}">
                                                    <option th:each="rol : ${roles}" th:value="${rol}"
                                                            th:text="${rol.texto}"></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-sm-4"
                                             th:if="${session.usuario.rol.toString() != 'INVITADO'}">
                                            <div class="form-group">
                                                <label for="pais">
                                                    <span th:text="#{text.edicionPerfil.form.label.pais}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <select id="pais" class="custom-select" th:field="*{idPais}">
                                                    <option th:each="pais : ${paises}" th:text="${pais.nombre}"
                                                            th:value="${pais.id}"
                                                            th:select="${usuario.idPais == pais.id}"></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div id="buscar-transportador" class="col-md-12 col-sm-12 d-none">
                                            <div class="alert alert-info" role="alert">
                                                <strong th:text="#{text.edicionPerfil.form.strong.info}"></strong>
                                                <span th:text="#{text.edicionPerfil.form.span.buscaTransportadora}"></span>
                                            </div>
                                            <div class="form-group">
                                                <label for="trans-select">
                                                    <span th:text="#{text.edicionPerfil.form.label.buscaTransportadora}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <select id="trans-select" class="custom-select" style="width: 100%">
                                                    <option th:value="${''}"
                                                            th:text="#{text.selecciona.opcion}"></option>
                                                    <option th:each="t : ${transportadores}" th:text="${t.nombre}"
                                                            th:value="${t.id}"></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h4 class="form-section">
                                                <i class="ft-globe"></i>
                                                <span th:text="#{text.edicionPerfil.form.span.ubicacion}"></span>
                                            </h4>
                                        </div>
                                        <div class="col-md-12 col-sm-12">
                                            <input type="hidden" th:field="*{idUbicacion}"
                                                   th:value="${usuario.idUbicacion}">
                                            <div class="row">
                                                <div class="col-md-6 col-sm-6">
                                                    <div class="form-group">
                                                        <label for="input-direccion">
                                                            <span th:text="#{text.edicionPerfil.form.label.ubicacion}"></span>
                                                            <span class="danger"> * </span>
                                                        </label>
                                                        <input id="input-direccion" class="form-control"
                                                               th:field="*{direccion}" th:value="*{direccion}"
                                                               type="text" readonly/>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 col-sm-3">
                                                    <div class="pull-right col-sm-12">
                                                        <button id="botonOrigen" type="button"
                                                                class="btn btn-success col-sm-12"
                                                                style="margin-top: 26px;" data-toggle="modal"
                                                                data-target="#tu-direccion">
                                                            <i class="la la-map-marker"></i>
                                                            <span th:text="#{text.edicionPerfil.form.span.cargarDomicilio}"></span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 col-sm-12">
                                                    <div class="form-group">
                                                        <label for="descripcion"
                                                               th:text="#{text.edicionPerfil.form.label.descripcion}"></label>
                                                        <textarea id="descripcion" class="form-control"
                                                                  th:field="*{descripcion}"
                                                                  th:value="*{descripcion}"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <label for="input-latitud" style="display: none"
                                                   th:text="#{text.edicionPerfil.form.label.latitud}"></label>
                                            <input id="input-latitud" style="display: none" th:field="*{latitud}"
                                                   th:value="*{latitud}" type="text"/>
                                            <label for="input-longitud" style="display: none"
                                                   th:text="#{text.edicionPerfil.form.label.longitud}"></label>
                                            <input id="input-longitud" style="display: none" th:field="*{longitud}"
                                                   th:value="*{longitud}" type="text"/>
                                        </div>
                                    </div>
                                    <div id="div-datos-transportador" class="row" style="display: none"
                                         th:if="${#strings.equals(usuario.rol, 'TRANSPORTADOR') || #strings.equals(usuario.rol, 'AMBAS') || #strings.equals(usuario.rol, 'SIN_ROL')}">
                                        <div class="col-md-12">
                                            <h4 class="form-section">
                                                <i class="ft-truck"></i>
                                                <span th:text="#{text.edicionPerfil.form.span.datosTransportadora}"></span>
                                            </h4>
                                        </div>
                                        <div class="col-md-12 col-sm-12">
                                            <div class="form-group">
                                                <label for="nombre-transportador">
                                                    <span th:text="#{text.edicionPerfil.form.label.nombre}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <input id="nombre-transportador" class="form-control"
                                                       th:value="${usuario.nombreTransportador}"
                                                       th:field="*{nombreTransportador}" type="text"/>
                                            </div>
                                        </div>
                                        <div class="col-md-12 col-sm-12">
                                            <div class="form-group">
                                                <label for="razon-social-transportador">
                                                    <span th:text="#{text.edicionPerfil.form.label.razonSocial}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <input class="form-control" id="razon-social-transportador"
                                                       th:value="${usuario.razonSocialTransportador}"
                                                       th:field="*{razonSocialTransportador}" type="text"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="div-datos-dador" class="row" style="display: none"
                                         th:if="${#strings.equals(usuario.rol, 'DADOR_CARGA') || #strings.equals(usuario.rol, 'AMBAS') || #strings.equals(usuario.rol, 'SIN_ROL')}">
                                        <div class="col-md-12">
                                            <h4 class="form-section">
                                                <i class="ft-package"></i>
                                                <span th:text="#{text.edicionPerfil.form.span.datosDadorCarga}"></span>
                                            </h4>
                                        </div>
                                        <div class="col-md-12 col-sm-12">
                                            <div class="form-group">
                                                <label for="nombre-dador">
                                                    <span th:text="#{text.edicionPerfil.form.label.nombre}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <input id="nombre-dador" class="form-control"
                                                       th:value="${usuario.nombreDador}" th:field="*{nombreDador}"
                                                       type="text"/>
                                            </div>
                                        </div>
                                        <div class="col-md-12 col-sm-12">
                                            <div class="form-group">
                                                <label for="razon-social-dador">
                                                    <span th:text="#{text.edicionPerfil.form.label.razonSocial}"></span>
                                                    <span class="danger"> * </span>
                                                </label>
                                                <input class="form-control" id="razon-social-dador"
                                                       th:field="*{razonSocialDador}"
                                                       th:value="${usuario.razonSocialDador}" type="text"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer text-right">
                                    <a th:href="@{/usuario/listado}"
                                       th:if="${session.usuario.rol.toString() != 'CHOFER'}">
                                        <button type="button" class="btn btn-secondary">
                                            <i class="ft-x"></i>
                                            <span th:text="#{text.btn.cancelar}"></span>
                                        </button>
                                    </a>
                                    <button type="button" class="btn btn-primary" id="btn-aceptar" onclick="validar()"
                                            th:if="${accion == null or accion == 'guardar'   or accion == 'actualizar'}">
                                        <i class="la la-check"></i>
                                        <span th:text="#{text.btn.guardar}"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </section>
        </div>
    </div>
</div>

<div class="sidenav-overlay"></div>
<div class="drag-target"></div>
<div class="modal fade bd-example-modal-lg" id="tu-direccion"
     tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-light black">
                <h5 class="modal-title black" id="exampleModalLabel"
                    th:text="#{text.edicionPerfil.form.h5.tuUbicacion}"></h5>
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close">
                    <i class="fa fa-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="contenedor-mapa">
                    <label for="pac-input" style="display: none"> </label> <input
                        id="pac-input" class="controls form-control" type="text"
                        th:placeholder="#{text.edicionPerfil.form.input.buscaTuUbicacion}">
                    <div id="map"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal" id="cargar-direccion"
                            th:text="#{text.edicionPerfil.form.button.asignarDomicilio}">
                        <i class="la la-map-marker"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<nav th:replace="fragments/componentes/plantilla :: footer"></nav>

<script type="text/javascript" th:inline="javascript">
    $("#localidades").select2();
    $("#trans-select").select2();
    $("#usuarios").select2();
    const buscarTransportador = document.getElementById("buscar-transportador");
    const cuitInput = document.getElementById("cuit");
    const direccionInput = document.getElementById("input-direccion");
    const divDatosDador = document.getElementById("div-datos-dador");
    const divDatosTransportador = document.getElementById("div-datos-transportador");
    const paisSelect = document.getElementById("pais");
    const razonSocialDador = document.getElementById("razon-social-dador");
    const razonSocialTransportador = document.getElementById("razon-social-transportador");
    const rolRequest = document.getElementById("rol-request");
    const rolSelect = document.getElementById("rol-select");

    cuitInput.addEventListener("blur", () => {
        cuitInput.value = cuitInput.value.replaceAll(/\D/g, "");
    });

    function validar() {
        const formulario = document.getElementById("formulario");
        const transSelect = document.getElementById("trans-select");
        console.log("Validando...");
        if ([[${usuario.rol}]] === "CHOFER") {
            console.log("dentro del primer if...");
            const idTransportador = [[${usuario.idTransportador}]];

            if (idTransportador != null && idTransportador !== "") {
                console.log("existe el id del transportador...");
                if (direccionInput.value == null || direccionInput.value === "" || cuitInput.value == null || cuitInput === "") {
                    Swal.queue([{
                        title: [[#{text.edicionPerfil.form.script.debeCompletar}]],
                        confirmButtonText: "OK",
                        icon: "info",
                    }]);

                    console.log("Falla la validacion del transportador");
                }

            } else if(buscarTransportador.classList.contains("d-none")) {
                console.log("Nuevo else Falla la validacion del transportador");
                Swal.queue([{
                    title: [[#{text.edicionPerfil.form.script.notienetransportador}]],
                    confirmButtonText: "OK",
                    icon: "info",
                }]);
                buscarTransportador.classList.remove("d-none");

            } else if (transSelect.value != null && transSelect.value !== "") {
                console.log("Por realizar el envio de la invitacion");
                enviarInvitacion().then(data => {
                    console.log("Realizando el envio de la invitacion");
                    if (data.error) {
                        console.log("Primer error");
                        console.log("Primer error: "+data.error)
                        Swal.fire(data.error);
                    } else {
                        console.log("Enviando ...");
                        $(buscarTransportador).hide(250);
                        //rolSelect.setAttribute("disabled", "disabled");
                        document.getElementById("btn-aceptar").removeAttribute("disabled");
                        Swal.fire({
                            title: [[#{text.edicionPerfil.form.script.solicitudEnviada}]],
                            confirmButtonText: "OK",
                        });
                    }
                }).catch(data => {
                    console.log("Segundo error");
                    console.log("Segundo error: "+data);
                    Swal.fire(data);
                });
            } else {
                console.log("Tercer error error");
                Swal.queue([{
                    title: [[#{text.edicionPerfil.form.script.seleccionaTransportadora}]],
                    confirmButtonText: "OK",
                    icon: "info",
                }]);

            }

            console.log("validar antes del SUBMIT");
            console.log(paisSelect.value == null || paisSelect.value === "" || direccionInput.value == null || direccionInput.value === "" || cuitInput.value == null || cuitInput === "");
            console.log("validar antes del SUBMIT 2");
            if (paisSelect.value == null || paisSelect.value === "" || direccionInput.value == null || direccionInput.value === "" || cuitInput.value == null || cuitInput === "") {
                console.log("Mensaje de error");
                console.log([[#{text.edicionPerfil.form.script.debeCompletar}]]);
                Swal.queue([{
                    title: [[#{text.edicionPerfil.form.script.debeCompletar}]],
                    confirmButtonText: "OK",
                    icon: "info",
                }]);
            } else {
                formulario.submit();
            }


        } else if (rolSelect.value === "CHOFER") {
            if (transSelect.value != null && transSelect.value !== "") {
                enviarInvitacion().then(data => {

                    if (data.error) {
                        Swal.fire(data.error);
                    } else {
                        $(buscarTransportador).hide(250);
                        rolSelect.setAttribute("disabled", "disabled");
                        document.getElementById("btn-aceptar").removeAttribute("disabled");
                        Swal.fire({
                            title: [[#{text.edicionPerfil.form.script.solicitudEnviada}]],
                            confirmButtonText: "OK",
                        });
                        formulario.submit();
                    }
                }).catch(data => {

                    Swal.fire(data);
                });
            } else {
                Swal.queue([{
                    title: [[#{text.edicionPerfil.form.script.seleccionaTransportadora}]],
                    confirmButtonText: "OK",
                    icon: "info",
                }]);

            }
        } else if (rolSelect.value == null || rolSelect.value === "" || paisSelect.value == null || paisSelect.value === "" ||
            direccionInput.value == null || direccionInput.value === "" || cuitInput.value == null || cuitInput === "") {
            Swal.queue([{
                title: [[#{text.edicionPerfil.form.script.debeCompletar}]],
                confirmButtonText: "OK",
                icon: "info",
            }]);
        } else {
            formulario.submit();
        }
    }

    if (razonSocialTransportador && razonSocialTransportador.value) {
        razonSocialTransportador.setAttribute("readonly", "readonly");
    }
    if (razonSocialDador && razonSocialDador.value) {
        razonSocialDador.setAttribute("readonly", "readonly");
    }

    window.onload = () => {
        const telefono = [[${usuario.telefono}]];
        const cuit = [[${usuario.cuit}]];
        const rol = [[${usuario.rol}]];

        if (telefono != null) {
            document.getElementById("telefono").value = telefono;
        }
        if (cuit != null && cuit !== "") {
            cuitInput.setAttribute("readonly", "readonly");
        }
        if (rol === "TRANSPORTADOR") {
            $(divDatosTransportador).show(250);
        } else if (rol === 'DADOR_CARGA') {
            $(divDatosDador).show(250);
        } else if (rol === 'AMBAS') {
            $(divDatosDador).show(250);
            $(divDatosTransportador).show(250);
        }

        document.getElementById("rol-request").value = rol;
        if (rolSelect) {
            rolSelect.value = rol;
        }

        const intTelInputConfig = {
            onlyCountries: ["ar", "cl", "br", "uy", "pr", "bo", "pe"],
            preferredCountries: ["ar", "cl", "br", "uy", "pr", "bo", "pe"],
            autoPlaceholder: "polite",
            utilsScript: "/assets/js/utils.js",
            customContainer: "form-group",
        };
        let input = document.querySelector("#telefono");
        let countryCode = window.intlTelInput(input, intTelInputConfig);
        addTelInputEventListener(input, countryCode, "telefono");

        let input2 = document.querySelector("#telefono-adicional");
        if (input2) {
            let countryCode2 = window.intlTelInput(input2, intTelInputConfig);
            addTelInputEventListener(input2, countryCode2, "telefono-adicional");
        }
    };

    function addTelInputEventListener(input, countryCode, element) {
        input.addEventListener("countrychange", () => {
            let x = countryCode.getSelectedCountryData();
            document.getElementById(element).value = "+" + x.dialCode;
        });
    }

    async function enviarInvitacion() {
        const entidad = {
            idChofer: [[${session.usuario.id}]],
            idTransportador: document.getElementById("trans-select").value,
        };
        const params = {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(entidad),
        };
        const response = await fetch("/api/invitacion/enviarinvitacion", params);
        return response.json();
    }

    if (rolSelect) {
        rolSelect.addEventListener("change", () => {
            rolRequest.value = rolSelect.value;
            if (rolSelect.value === 'DADOR_CARGA') {
                $(divDatosDador).show(250);
                $(divDatosTransportador).hide(250);
                $(buscarTransportador).hide(250);
                alertaCambioDeRol();
            } else if (rolSelect.value === 'TRANSPORTADOR') {
                $(divDatosTransportador).show(250);
                $(divDatosDador).hide(250);
                $(buscarTransportador).hide(250);
                alertaCambioDeRol();
            } else if (rolSelect.value === 'AMBAS') {
                $(divDatosDador).show(250);
                $(divDatosTransportador).show(250);
                $(buscarTransportador).hide(250);
                alertaCambioDeRol();
            } else if (rolSelect.value === 'CHOFER') {
                $(buscarTransportador).show(250);
                $(divDatosDador).hide(250);
                divDatosDador.value = null;
                $(divDatosTransportador).hide(250);
                divDatosTransportador.value = null;
                Swal.fire({
                    title: [[#{text.edicionPerfil.form.script.buscaTransportador}]],
                    confirmButtonText: "OK",
                });
            }
        });
    }

    function alertaCambioDeRol() {
        Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-info',
                cancelButton: 'btn btn-danger'
            },
            buttonsStyling: false
        }).fire({
            title: [[#{text.edicionPerfil.form.script.debidoCambioRol}]],
            icon: 'info',
            confirmButtonText: 'Ok',
            reverseButtons: true
        });
    }
</script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

<script>
    const initialPos = {
        lat: -33.6091754,
        lng: -63.4685812
    };
    let map, searchBox, input, markers, geocoder, infowindow;

    function initAutocomplete() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: initialPos,
            zoom: 6.22,
            mapTypeId: 'roadmap',
            zoomControl: false,
            mapTypeControl: false
        });
        geocoder = new google.maps.Geocoder;
        infowindow = new google.maps.InfoWindow;
        markers = [];
        input = document.getElementById('pac-input');
        searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
        map.addListener('bounds_changed', function () {
            searchBox.setBounds(map.getBounds());
        });

        searchBox.addListener('places_changed', function () {
            let places = searchBox.getPlaces();

            if (places.length === 0) {
                return;
            }

            markers.forEach(function (marker) {
                marker.setMap(null);
            });
            markers = [];

            let bounds = new google.maps.LatLngBounds();

            places.forEach(function (place) {
                if (!place.geometry) {
                    console.log("Returned place contains no geometry");
                    return;
                }
                markers.push(new google.maps.Marker({
                    map: map,
                    title: place.name,
                    position: place.geometry.location
                }));
                if (place.geometry.viewport) {
                    bounds.union(place.geometry.viewport);
                } else {
                    bounds.extend(place);
                }
            });

            map.fitBounds(bounds);

            let lat = map.getCenter().lat();
            let lon = map.getCenter().lng();
            $('#input-latitud').val(lat);
            $('#input-longitud').val(lon);
            $('#input-direccion').val($("#pac-input").val());
        });
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDz6kEuRri8bQ3TXQn2e5t0KVBqQpQHbwM&libraries=places&callback=initAutocomplete"
        async defer></script>
</body>
</html>
